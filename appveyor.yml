
version: 0.5.{build}

branches:
  only:
    - master

max_jobs: 1

image:
- Visual Studio 2017

init:
  - git config --global core.autocrlf false

clone_depth: 3

hosts:
  queue-server: 127.0.0.1
  db.server.com: 127.0.0.2

platform: x64

configuration: Release

cache:
  - C:\ProgramData\chocolatey\bin -> appveyor.yml # swig.exe
  - C:\ProgramData\chocolatey\lib -> appveyor.yml # supporting swig Lib files.

install:
  - git submodule update --init
  - curl -o mkn.exe -L https://github.com/Dekken/maiken/raw/binaries/win10_x64/mkn.exe
  - IF NOT EXIST C:\ProgramData\chocolatey\bin\swig.exe choco install tools\windows\swig.4.0.0.nupkg --yes --limit-output #> $null
  - cat C:\ProgramData\chocolatey\logs\chocolatey.log
  - git clone https://github.com/X-DataInitiative/tick_appveyor -b master --depth 1 appveyor

build_script:
  - cp "C:\Program Files (x86)\Windows Kits\10\bin\x64\rc.exe" %CD%
  - cp %CD%\rc.exe %CD%\lib
  - call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvars64.bat"
  - cl # print compiler version
  # doesnt exist for somereason?
  - mkdir -p "C:\Program Files (x86)\Windows Kits\10\include\10.0.16299.0\cppwinrt"

  - bash -c "PATH=\"$PWD:/c/Python37-x64/:/c/Program Files/Git/usr/bin:$PATH\"; tools/appveyor/run.sh"

artifacts:
  - path: "dist\\*.*"
    name: Wheels

deploy:
- provider: BinTray
  username: dekken
  api_key:
    secure: dQepGOZ7aTjyS7w0zGbvHOSstW9Nl8BblfP7XzWkNpOVN6eaFBfqKh1qmJeAeFUjgDIaVa583vZQLYIW9GXFInVo7h1SamKU09tYiFgSdsOs8NOCTJ6PYcYkh3oMdxQ0HeNW+nGy5Ptx6GG9ry16k8wiAte3u1YuBxYhF/hISZ4wcB9FkIOFBksFKhi5AYuC5X7g4WNbJtdfPln4taBCSTMGhwgFsdaCRG2edP8NaIesG4Kx3lY9y3+A3OyY9O3KMJzyvQYA6X+2EhonHw3uJt+6QlanFgFwpdWbHvWoSx8kS5jl7fF9yLUojA3hAMPIN9+Uu4VQKJ8PaLUvhVijwB/ef5emrnVa0h6YArVBjW2UKPl0KwQfAdcVqtcmooxEqhbpqfQItZaqIHT2XPDXdwPqLsGnB/mFBJwBYVtJIktUViHFRMGQC89s94qRuzWjW5V+CPEuBmVlZ11GgOzkTujeZGGnxwqUCzPgtFlL8yDIQsf7Dkwiz0FN108HswgMF44n4VtzZHJUKZ3kCc7Ew30NWrbOkNrWBkLJFvfsM3e999WAJ7Se3xxOcFXIuoOEjs8faJE6U/yQpSuIIZmxNadVVfbAxHE6pm/fm0zb5Qk0OetegXa8mxWUELLcdvc9aY7/JCJ5btIyKiVkCvsxw3CyF/qAXVfIym3g4fgmhl8=
  subject: x-datainitiative
  repo: tick
  package: wheels
  publish: true
  override: true
  explode: true
  artifact: dist/*
